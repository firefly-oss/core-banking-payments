name: Publish to GitHub Packages

on:
  push:
    branches: ["main", "develop"]
  pull_request:

jobs:
  build-and-publish:
    uses: catalis-vc/cicd/.github/workflows/build-maven.yaml@main
    with:
      java-version: "21"
      skip-tests: false
    secrets:
      PAT_GITHUB_PACKAGE: ${{ secrets.PAT_GITHUB_PACKAGE }}

  build-and-publish-docker:
    name: Docker Publish to ACR
    needs: build-and-publish
    uses: catalis-vc/cicd/.github/workflows/docker-publish.yaml@main
    with:
      dockerfile-path: "./Dockerfile"
      azure-registry-name: "catalis.azurecr.io"
      azure-registry-repository: "core-banking-payments"
      docker-image-tag: "latest"
    secrets:
      AZURE_ACR_USERNAME: ${{ secrets.AZURE_ACR_USERNAME }}
      AZURE_ACR_PASSWORD: ${{ secrets.AZURE_ACR_PASSWORD }}